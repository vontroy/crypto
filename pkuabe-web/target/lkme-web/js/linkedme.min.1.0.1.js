/*! linkedme (c) 2016 build 2016-07-05 v1.0.1 */
!function(){function a(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""}function b(a){return a.indexOf("live")>-1?server.LinkedME_LIVE_URL:a.indexOf("test")>-1?server.LinkedME_TEST_URL:void alert("无效的linkedme_key!")}var c=function(){};c.prototype.DEBUG=!0,c.prototype.TIMEOUT=5e3,c.prototype.LinkedME_KEY="",c.prototype.LinkedME_SESSION_ID="",c.prototype.version="1.0.1";var d=function(){};d.prototype.XHRRequest=function(a,b,c,d,e,f){var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.ontimeout=function(){e("timeout",null,504)},g.onerror=function(a){e(a.error||"Error in API: "+g.status,null,g.status)},g.onreadystatechange=function(){var a;if(4===g.readyState)if(200===g.status){if(f)a=g.responseText;else try{a=JSON.parse(g.responseText)}catch(b){a={}}e(null,a,g.status)}else 402===g.status?e("Not enough credits to redeem.",null,g.status):"4"!==g.status.toString().substring(0,1)&&"5"!==g.status.toString().substring(0,1)||e("Error in API: "+g.status,null,g.status)};try{g.open(c,a,!0),g.timeout=this.TIMEOUT,g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send(b)}catch(h){console.log(h)}},d.prototype.LinkedME_LIVE_URL="http://lkme.cc/i",d.prototype.LinkedME_TEST_URL="http://lkme.cc/t",window.server=new d,c.prototype.init=function(c,d,e){this.DEBUG&&console.log("linkedme.init()");var f=b(c)+"/sdk/webinit";if(this.LinkedME_SESSION_ID&&this.LinkedME_KEY==c){var g=a("identity_id");e(null,{identity_id:g,session_id:this.LinkedME_SESSION_ID},null)}else this.LinkedME_KEY=c,server.XHRRequest(f+"?linkedme_key="+c+"&identity_id="+a("identity_id"),d,"get",null,function(a,b){this.LinkedME_SESSION_ID=b.session_id,document.cookie="identity_id="+b.identity_id,e(a,b)},null)},c.prototype.link=function(c,d,e){this.DEBUG&&console.log("linkedme.link()");var f=b(this.LinkedME_KEY)+"/sdk/url";if(!c&&(c={}),c.linkedme_key=this.LinkedME_KEY,c.session_id=this.LinkedME_SESSION_ID,c.identity_id=a("identity_id"),c.params){var g=JSON.parse(c.params);c.params={},c.params.$control=g,c.params=JSON.stringify(c.params)}else c.params="{}";c.source="Web",c.sdk_version="web1.0.1",c.timestamp=+new Date,c.sign="";var h=[];for(var i in c)h.push(encodeURIComponent(i)+"="+encodeURIComponent(c[i]));server.XHRRequest(f,h.join("&"),"post",null,function(a,b){a?d(a,b):b.err_code?d(a,b):e?(window.location=b.url,d(a,b)):d(a,b)})},c.prototype.close=function(){this.DEBUG&&console.log("linkedme.close()");var c={};c.linkedme_key=this.LinkedME_KEY,c.session_id=this.LinkedME_SESSION_ID,c.identity_id=a("identity_id"),c.timestamp=+new Date;var d=[];for(var e in c)d.push(encodeURIComponent(e)+"="+encodeURIComponent(c[e]));var f=b(this.LinkedME_KEY)+"/sdk/webclose";server.XHRRequest(f,d.join("&"),"post",null,function(a,b){})},window.linkedme=new c,window.onbeforeunload=function(){linkedme.close(null)}}();